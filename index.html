<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AVA Warsztat Samochodowy</title>
  <meta name="description" content="AVA Warsztat ‚Äì naprawa samochod√≥w, diagnostyka, mechanika. Zapraszamy!" />
  <meta name="keywords" content="AVA, warsztat, samochodowy, auto, mechanik, serwis, avawarsztat" />
  <meta name="author" content="AVA Warsztat" />

  <!-- Open Graph (dla udostƒôpnie≈Ñ) -->
  <meta property="og:title" content="AVA Warsztat Samochodowy" />
  <meta property="og:description" content="Z pasji do aut ‚Äì profesjonalny serwis i naprawy." />
  <meta property="og:image" content="ava-logo.jpg" />
  <meta property="og:type" content="website" />

  <!-- Favicon (podmie≈Ñ plik je≈õli potrzeba) -->
  <link rel="icon" type="image/png" href="favicon.png">

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

  <!-- Font Awesome (ikony) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha512-wx6o2f..." crossorigin="anonymous" referrerpolicy="no-referrer" />

  <style>
    :root{
      --bg: #1d1d1d;
      --card: #111;
      --muted: #9aa0a6;
      --accent: #007bff;
      --accent-2: #28a745;
      --glass: rgba(255,255,255,0.03);
      --radius: 10px;
      --max-width: 1100px;
    }

    *{box-sizing: border-box;}
    html,body{height:100%;}
    body {
      margin: 0;
      font-family: 'Poppins', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background-color: var(--bg);
      color: #fff;
      overflow-x: hidden;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      line-height:1.45;
    }

    a { color: inherit; text-decoration: none; }
    img { max-width:100%; height:auto; display:block; }

    header.site-header {
      padding: 28px 20px;
      border-bottom: 1px solid rgba(255,255,255,0.03);
      background: linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
      position: sticky;
      top: 0;
      z-index: 50;
      backdrop-filter: blur(4px);
    }

    .wrap { max-width: var(--max-width); margin: 0 auto; padding: 0 16px; }

    .nav {
      display:flex; align-items:center; justify-content:space-between; gap: 16px;
    }

    .brand {
      display:flex; align-items:center; gap:12px;
    }
    .brand img { width:48px; height:48px; border-radius:8px; object-fit:cover; }
    .brand h1 { font-size:20px; margin:0; font-weight:700; letter-spacing:0.3px; }

    nav a.nav-link {
      color: var(--muted);
      margin-left: 12px;
      font-weight:500;
      font-size:14px;
    }
    nav a.nav-link:hover { color: #fff; }

    main { padding: 28px 0 80px; }

    .hero {
      text-align:center;
      padding: 48px 16px;
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(0,0,0,0.2), rgba(255,255,255,0.01));
      box-shadow: 0 6px 20px rgba(0,0,0,0.6);
      margin-bottom: 28px;
    }

    .hero h2 { margin: 0 0 8px; font-size:28px; }
    .hero p.subtitle { margin: 8px 0 18px; color:var(--muted); }

    .cta-row { display:flex; flex-wrap:wrap; justify-content:center; gap:12px; margin-top:10px; }

    .btn {
      display:inline-flex; align-items:center; gap:8px;
      padding:12px 20px; border-radius:12px; font-weight:600;
      background:var(--accent); color:#fff; border:none; cursor:pointer; transition: transform .14s ease, box-shadow .14s ease;
      box-shadow: 0 6px 18px rgba(0,0,0,0.6);
    }
    .btn.alt { background:var(--accent-2); }
    .btn.ghost { background: transparent; border:1px solid rgba(255,255,255,0.06); color:var(--muted); }

    .btn:hover { transform: translateY(-3px); }

    .section {
      background: linear-gradient(180deg, rgba(255,255,255,0.01), transparent);
      margin: 18px 0;
      padding: 28px;
      border-radius: var(--radius);
    }

    .two-col { display:grid; grid-template-columns: 1fr 340px; gap:20px; align-items:start; }
    .card { background: var(--card); padding:16px; border-radius:10px; border:1px solid rgba(255,255,255,0.02); }

    h2.section-title { margin-top:0; font-size:20px; }

    ul.clean { padding:0; list-style:none; margin:0; display:flex; flex-direction:column; gap:8px; }
    ul.clean li { padding-left:8px; color:var(--muted); }

    /* opinie */
    #opinie-container div.opinia {
      border-bottom: 1px solid rgba(255,255,255,0.03); padding:12px 0;
    }
    #opinie-container p.meta { color:var(--muted); margin:6px 0 0; font-size:13px; }

    /* form inputs */
    input[type="text"], input[type="email"], textarea, select {
      background: var(--glass); color:#fff; border:1px solid rgba(255,255,255,0.06);
      padding:10px; border-radius:8px; width:100%; font-size:14px;
    }
    label { display:block; margin-bottom:6px; color:var(--muted); font-size:14px; }

    .small { font-size:13px; color:var(--muted); }

    footer.site-footer {
      padding: 18px 0; margin-top:40px; border-top: 1px solid rgba(255,255,255,0.03);
    }

    /* reveal effect */
    .reveal { opacity:0; transform: translateY(20px); transition: opacity .6s ease, transform .6s ease; }
    .reveal.active { opacity:1; transform: translateY(0); }

    /* modal */
    .modal-backdrop {
      position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:200;
      background: rgba(0,0,0,0.6);
    }
    .modal {
      width: 360px; max-width:calc(100% - 32px); background: var(--card); padding:18px; border-radius:12px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.7);
    }
    .modal h3 { margin:0 0 8px; }
    .modal .actions { display:flex; gap:8px; justify-content:flex-end; margin-top:12px; }

    /* responsive */
    @media (max-width: 900px) {
      .two-col { grid-template-columns: 1fr; }
      .brand h1 { font-size:18px; }
    }
    @media (max-width: 600px) {
      .hero h2 { font-size:22px; }
      .cta-row { flex-direction:column; }
      .brand img { width:40px; height:40px; }
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="wrap nav" role="navigation" aria-label="G≈Ç√≥wna nawigacja">
      <div class="brand">
        <img src="ava-logo.jpg" alt="Logo AVA Warsztat">
        <div>
          <h1>AVA Warsztat</h1>
          <div class="small">Naprawy | Diagnostyka | Serwis</div>
        </div>
      </div>

      <nav>
        <a class="nav-link" href="#misja">Misja</a>
        <a class="nav-link" href="#uslugi">Us≈Çugi</a>
        <a class="nav-link" href="#godziny">Godziny</a>
        <a class="nav-link" href="#opinie">Opinie</a>
        <a class="nav-link" href="#faq">FAQ</a>
      </nav>
    </div>
  </header>

  <main class="wrap" id="main">
    <section class="hero reveal" aria-labelledby="hero-title">
      <h2 id="hero-title">AVA Warsztat Samochodowy</h2>
      <p class="subtitle">Z pasji do aut ‚Äî naprawiamy, serwisujemy i diagnostykujemy z rzetelno≈õciƒÖ.</p>

      <div class="cta-row" role="group" aria-label="Akcje">
        <a class="btn alt" href="tel:+48601749485" aria-label="Zadzwo≈Ñ do AVA"><i class="fa-solid fa-phone"></i> Zadzwo≈Ñ</a>
        <a class="btn" href="#map" aria-label="Zobacz lokalizacjƒô"><i class="fa-solid fa-map-location-dot"></i> Lokalizacja</a>
        <button id="openEmailModal" class="btn ghost" aria-haspopup="dialog"><i class="fa-solid fa-envelope"></i> Napisz do nas</button>
        <a class="btn" href="https://www.facebook.com/profile.php?id=100075824936537" target="_blank" rel="noopener" aria-label="Facebook"><i class="fa-brands fa-facebook"></i> Facebook</a>
      </div>
    </section>

    <section id="misja" class="section reveal" aria-labelledby="misja-title">
      <h2 id="misja-title" class="section-title">Nasza misja</h2>
      <p style="color:var(--muted); max-width:900px;">
        NaszƒÖ misjƒÖ jest dostarczanie niezawodnych i uczciwych us≈Çug motoryzacyjnych ka≈ºdemu klientowi.
        Z pasji do aut i perfekcji ‚Äì naprawiamy tak, jakby to by≈Ço nasze w≈Çasne auto.
      </p>
    </section>

    <section class="section two-col reveal" aria-labelledby="about-title">
      <div>
        <h2 id="about-title" class="section-title">O nas</h2>
        <p class="small">
          W AVA dbamy o Tw√≥j samoch√≥d jak o w≈Çasny. Nasza pasja do motoryzacji i wieloletnie do≈õwiadczenie
          pozwalajƒÖ nam oferowaƒá us≈Çugi na najwy≈ºszym poziomie. Zapraszamy klient√≥w indywidualnych i firmy.
        </p>

        <div class="section" style="margin-top:16px;">
          <h3 class="section-title">Dlaczego warto nas wybraƒá?</h3>
          <ul class="clean">
            <li>‚úÖ Do≈õwiadczona kadra mechanik√≥w</li>
            <li>‚úÖ Szybkie terminy realizacji</li>
            <li>‚úÖ Uczciwe i przejrzyste ceny</li>
            <li>‚úÖ Gwarancja na wykonane us≈Çugi</li>
          </ul>
        </div>

        <div class="section" style="margin-top:16px;">
          <h3 class="section-title">Nasze us≈Çugi</h3>
          <ul class="clean">
            <li>üîß Diagnostyka komputerowa</li>
            <li>üî© Wymiana oleju i filtr√≥w</li>
            <li>üöó Naprawy zawieszenia</li>
            <li>‚ùÑÔ∏è Serwis klimatyzacji</li>
            <li>üîß Wulkanizacja i wymiana opon</li>
          </ul>
        </div>
      </div>

      <aside class="card" aria-label="Informacje boczne">
        <h3 style="margin-top:0;">Kontakt & godziny</h3>
        <p class="small">Tel: <a href="tel:+48601749485">+48 601 749 485</a></p>
        <p class="small">E-mail: <a href="mailto:ava.autosklep@gmail.com">ava.autosklep@gmail.com</a></p>

        <div style="margin-top:12px;">
          <h4 style="margin:0 0 6px;">Godziny otwarcia</h4>
          <p class="small">Pon‚ÄìPt: <strong>8:00‚Äì16:00</strong></p>
          <p class="small">Sob‚ÄìNd: <strong>Nieczynne</strong></p>
          <p id="statusWarsztatu" style="font-weight:700; margin-top:8px;"></p>
        </div>

        <div style="margin-top:14px;">
          <h4 style="margin:0 0 6px;">Dzia≈Çamy od</h4>
          <p class="small">üìÖ <strong id="years-count"></strong> lat</p>
        </div>
      </aside>
    </section>

    <section id="map" class="section reveal" aria-labelledby="map-title">
      <h2 id="map-title" class="section-title">Gdzie nas znale≈∫ƒá</h2>
      <div style="display:grid; grid-template-columns: 1fr 320px; gap:16px;">
        <div class="card" style="padding:0;">
          <!-- Podmie≈Ñ src je≈õli potrzebujesz dok≈Çadnego embed z Google Maps -->
          <iframe
            title="Mapa AVA Warsztat"
            src="https://www.google.com/maps?q=warsztat+AVA&output=embed"
            width="100%" height="360" style="border:0; border-radius:10px;"></iframe>
        </div>
        <div class="card">
          <h4 style="margin-top:0;">Adres</h4>
          <p class="small">Podaj tu dok≈Çadny adres warsztatu aby mapa by≈Ça precyzyjna.</p>
          <p style="margin-top:10px;"><a href="https://maps.google.com?q=warsztat+AVA" target="_blank" rel="noopener">Otw√≥rz w Google Maps</a></p>
        </div>
      </div>
    </section>

    <section id="opinie" class="section reveal" aria-labelledby="opinie-title">
      <h2 id="opinie-title" class="section-title">Opinie klient√≥w</h2>

      <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
        <button id="toggle-opinie" class="btn ghost" aria-expanded="false">Poka≈º opinie</button>
        <button id="showFormBtn" class="btn alt">Dodaj opiniƒô</button>
      </div>

      <div id="opinionForm" class="card" style="display:none; margin-top:14px;">
        <form id="feedbackForm" novalidate>
          <label for="name">Twoje imiƒô</label>
          <input id="name" name="name" type="text" placeholder="np. Janek" />

          <label for="rating" style="margin-top:8px;">Ocena warsztatu</label>
          <select id="rating" name="rating" required>
            <option value="">Wybierz ocenƒô</option>
            <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</option>
            <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê</option>
            <option value="3">‚≠ê‚≠ê‚≠ê</option>
            <option value="2">‚≠ê‚≠ê</option>
            <option value="1">‚≠ê</option>
          </select>

          <label for="comment" style="margin-top:8px;">Komentarz</label>
          <textarea id="comment" name="comment" rows="4" placeholder="Opisz swojƒÖ wizytƒô..."></textarea>

          <div style="display:flex; gap:8px; margin-top:12px; justify-content:flex-end;">
            <button type="submit" class="btn">Wy≈õlij opiniƒô</button>
            <button type="button" id="cancelFormBtn" class="btn ghost">Anuluj</button>
          </div>

          <p id="formMsg" class="small" style="margin-top:10px;"></p>
        </form>
      </div>

      <h3 id="srednia-ocena" style="margin-top:16px;">≈örednia ocena: ‚è≥</h3>
      <div id="opinie-container" style="margin-top:14px;"></div>
    </section>

    <section id="faq" class="section reveal" aria-labelledby="faq-title">
      <h2 id="faq-title" class="section-title">‚ùì Najczƒô≈õciej zadawane pytania</h2>
      <details><summary>Jak mogƒô um√≥wiƒá siƒô na wizytƒô?</summary><p>Mo≈ºesz zadzwoniƒá, napisaƒá e-mail lub u≈ºyƒá formularza kontaktowego.</p></details>
      <details><summary>Czy oferujecie samoch√≥d zastƒôpczy?</summary><p>Nie, aktualnie nie posiadamy samochodu zastƒôpczego.</p></details>
      <details><summary>Jakie auta naprawiacie?</summary><p>Naprawiamy wszystkie marki osobowe i dostawcze (opr√≥cz aut elektrycznych).</p></details>
      <details><summary>Czy muszƒô siƒô wcze≈õniej umawiaƒá?</summary><p>Tak ‚Äî najlepiej zadzwoniƒá lub napisaƒá. W nag≈Çych przypadkach spr√≥bujemy pom√≥c od rƒôki.</p></details>
    </section>
  </main>

  <footer class="site-footer">
    <div class="wrap" style="display:flex; justify-content:space-between; gap:12px; align-items:center;">
      <div class="small">¬© <span id="year"></span> AVA Warsztat Samochodowy. Wszystkie prawa zastrze≈ºone.</div>
      <div class="small">E-mail: <a href="mailto:ava.autosklep@gmail.com">ava.autosklep@gmail.com</a></div>
    </div>
  </footer>

  <!-- Modal: Weryfikacja e-mail -->
  <div id="modalBackdrop" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" role="document" aria-labelledby="modalTitle">
      <h3 id="modalTitle">Weryfikacja e-mail</h3>
      <p class="small" id="modalDesc">Aby dodaƒá opiniƒô, podaj e-mail ‚Äî wy≈õlemy kod weryfikacyjny (symulacja).</p>

      <div id="stepEmail">
        <label for="modalEmail">Adres e-mail</label>
        <input id="modalEmail" type="email" placeholder="twoj@email.pl" />
        <div class="actions">
          <button id="modalCancel" class="btn ghost">Anuluj</button>
          <button id="modalSendCode" class="btn">Wy≈õlij kod</button>
        </div>
      </div>

      <div id="stepCode" style="display:none; margin-top:8px;">
        <label for="modalCode">Kod weryfikacyjny</label>
        <input id="modalCode" type="text" placeholder="Wpisz kod" />
        <div class="small" id="simCodeHint" style="margin-top:6px;"></div>
        <div class="actions">
          <button id="modalBack" class="btn ghost">Wr√≥ƒá</button>
          <button id="modalVerify" class="btn">Zweryfikuj</button>
        </div>
      </div>
    </div>
  </div>

<script>
  // --- Dane startowe ---
  const startYear = 1996;
  document.getElementById("years-count").textContent = new Date().getFullYear() - startYear;
  document.getElementById("year").textContent = new Date().getFullYear();

  // --- Reveal on scroll ---
  function revealOnScroll() {
    document.querySelectorAll('.reveal').forEach(elem => {
      const top = elem.getBoundingClientRect().top;
      if (top < window.innerHeight - 100) elem.classList.add("active");
    });
  }
  window.addEventListener("scroll", revealOnScroll);
  window.addEventListener("DOMContentLoaded", () => {
    revealOnScroll();
    sprawdzGodzine();
  });

  // --- Godziny otwarcia (z obs≈ÇugƒÖ ≈õwiƒÖt) ---
  function sprawdzGodzine() {
    const teraz = new Date();
    const dzienTygodnia = teraz.getDay(); // 0 niedziela
    const godzina = teraz.getHours();
    const data = `${(teraz.getMonth() + 1).toString().padStart(2, '0')}-${teraz.getDate().toString().padStart(2, '0')}`;
    const status = document.getElementById('statusWarsztatu');

    const swieta = ['01-01','01-06','05-01','05-03','08-15','11-01','11-11','12-25','12-26'];

    if (swieta.includes(data)) {
      status.textContent = "üéâ Dzi≈õ ≈õwiƒôto ‚Äì warsztat nieczynny.";
      status.style.color = "orange";
    } else if ([1,2,3,4,5].includes(dzienTygodnia) && godzina >= 8 && godzina < 16) {
      status.textContent = "üîß Otwarte ‚Äì zapraszamy!";
      status.style.color = "lime";
    } else {
      status.textContent = "‚ùå Zamkniƒôte ‚Äì zapraszamy w godzinach 8:00‚Äì16:00 (pn‚Äìpt)";
      status.style.color = "tomato";
    }
  }

  // --- Opinie (SheetDB) ---
  const SHEETDB_URL = 'https://sheetdb.io/api/v1/kr749eomw8d09';

  async function loadOpinie() {
    const container = document.getElementById('opinie-container');
    const sredniaElement = document.getElementById('srednia-ocena');
    container.innerHTML = '<div class="small">≈Åadowanie opinii...</div>';
    sredniaElement.textContent = '≈örednia ocena: ‚è≥';

    try {
      const res = await fetch(SHEETDB_URL);
      if (!res.ok) throw new Error('B≈ÇƒÖd sieci przy pobieraniu danych.');
      const data = await res.json();

      if (!Array.isArray(data) || data.length === 0) {
        container.innerHTML = '<div class="small">Brak opinii.</div>';
        sredniaElement.textContent = 'Brak ocen.';
        return;
      }

      let suma = 0, liczbaOcen = 0;
      container.innerHTML = '';
      // poka≈º od najnowszych
      data.slice().reverse().forEach(entry => {
        const rating = parseInt(entry.rating || 0, 10);
        const comment = (entry.comment || '').trim();
        const name = (entry.name || 'Anonimowy klient').trim();

        if (rating > 0) { suma += rating; liczbaOcen++; }

        const div = document.createElement('div');
        div.className = 'opinia';
        div.innerHTML = `
          <p style="margin:0 0 6px;">${comment ? `"${escapeHtml(comment)}"` : '<span class="small">Bez komentarza</span>'}</p>
          <p class="meta">${'‚≠ê'.repeat(Math.max(0, Math.min(5, rating)))} <span style="margin-left:8px;">‚Äì ${escapeHtml(name)}</span></p>
        `;
        container.appendChild(div);
      });

      const srednia = liczbaOcen ? (suma / liczbaOcen).toFixed(1) : null;
      sredniaElement.textContent = srednia ? `≈örednia ocena: ‚≠ê ${srednia}/5 (${liczbaOcen} ocen)` : 'Brak ocen.';
    } catch (err) {
      container.innerHTML = '<div class="small">B≈ÇƒÖd ≈Çadowania opinii.</div>';
      sredniaElement.textContent = 'B≈ÇƒÖd odczytu ≈õredniej oceny.';
      console.error(err);
    }
  }

  // Escape pomocniczy
  function escapeHtml(unsafe) {
    return unsafe
      .replaceAll('&', '&amp;')
      .replaceAll('<', '&lt;')
      .replaceAll('>', '&gt;')
      .replaceAll('"', '&quot;')
      .replaceAll("'", '&#039;');
  }

  // Toggle opinie
  document.getElementById("toggle-opinie").addEventListener("click", function () {
    const btn = this;
    const lista = document.getElementById("opinie-container");
    const visible = lista.offsetParent !== null; // sprawd≈∫ widoczno≈õƒá
    if (!visible) {
      lista.style.display = "block";
      btn.textContent = "Ukryj opinie";
      btn.setAttribute('aria-expanded', 'true');
      loadOpinie();
    } else {
      lista.style.display = "none";
      btn.textContent = "Poka≈º opinie";
      btn.setAttribute('aria-expanded', 'false');
    }
  });

  // Poka≈º / ukryj formularz opinii
  document.getElementById('showFormBtn').addEventListener('click', () => {
    document.getElementById('opinionForm').style.display = 'block';
    document.getElementById('showFormBtn').style.display = 'none';
    window.scrollTo({ top: document.getElementById('opinionForm').offsetTop - 20, behavior: 'smooth' });
  });
  document.getElementById('cancelFormBtn').addEventListener('click', () => {
    document.getElementById('opinionForm').style.display = 'none';
    document.getElementById('showFormBtn').style.display = 'inline-block';
    document.getElementById('feedbackForm').reset();
    document.getElementById('formMsg').textContent = '';
  });

  // --- Modal e-mail (zastƒôpuje prompt) ---
  const modalBackdrop = document.getElementById('modalBackdrop');
  const openEmailModalBtn = document.getElementById('openEmailModal');
  const modalCancel = document.getElementById('modalCancel');
  const modalSendCode = document.getElementById('modalSendCode');
  const modalBack = document.getElementById('modalBack');
  const modalVerify = document.getElementById('modalVerify');
  const stepEmail = document.getElementById('stepEmail');
  const stepCode = document.getElementById('stepCode');
  const modalEmailInput = document.getElementById('modalEmail');
  const modalCodeInput = document.getElementById('modalCode');
  const simCodeHint = document.getElementById('simCodeHint');

  let currentVerification = { email: null, code: null };

  openEmailModalBtn.addEventListener('click', () => {
    modalBackdrop.style.display = 'flex';
    modalBackdrop.setAttribute('aria-hidden', 'false');
    stepEmail.style.display = 'block';
    stepCode.style.display = 'none';
    modalEmailInput.value = '';
    modalCodeInput.value = '';
    simCodeHint.textContent = '';
    modalEmailInput.focus();
  });

  modalCancel.addEventListener('click', closeModal);
  modalBack.addEventListener('click', () => {
    stepEmail.style.display = 'block';
    stepCode.style.display = 'none';
    simCodeHint.textContent = '';
  });

  function closeModal() {
    modalBackdrop.style.display = 'none';
    modalBackdrop.setAttribute('aria-hidden', 'true');
  }

  // Send (simulate) code
  modalSendCode.addEventListener('click', () => {
    const email = modalEmailInput.value.trim();
    if (!email || !/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(email)) {
      alert('Podaj poprawny adres e-mail.');
      modalEmailInput.focus();
      return;
    }

    // wygeneruj kod
    const code = Math.floor(100000 + Math.random() * 900000).toString();
    currentVerification = { email, code };

    // W realnym wdro≈ºeniu: wy≈õlij e-mail. Tutaj: symulacja ‚Äî poka≈º wskaz√≥wkƒô do test√≥w.
    simCodeHint.textContent = `Dla cel√≥w testu kod to: ${code}`;
    stepEmail.style.display = 'none';
    stepCode.style.display = 'block';
    modalCodeInput.focus();
  });

  // Weryfikacja kodu
  modalVerify.addEventListener('click', () => {
    const wpisany = modalCodeInput.value.trim();
    if (!currentVerification.code) { alert('Brak wys≈Çanego kodu ‚Äî rozpocznij od poczƒÖtku.'); return; }
    if (wpisany === currentVerification.code) {
      // powiadom formularz opinii o zweryfikowanym e-mailu (ustaw ukrytƒÖ warto≈õƒá)
      document.getElementById('feedbackForm').dataset.verifiedEmail = currentVerification.email;
      closeModal();
      alert('E-mail zweryfikowany ‚Äî mo≈ºesz teraz wys≈Çaƒá opiniƒô.');
      // automatycznie poka≈º formularz je≈õli ukryty
      document.getElementById('opinionForm').style.display = 'block';
      document.getElementById('showFormBtn').style.display = 'none';
    } else {
      alert('B≈Çƒôdny kod weryfikacyjny. Sprawd≈∫ i spr√≥buj ponownie.');
      modalCodeInput.focus();
    }
  });

  // --- Submit opinii (z 24h blokadƒÖ) ---
  document.getElementById('feedbackForm').addEventListener('submit', async function (e) {
    e.preventDefault();
    const form = this;

    // 24h blokada
    const ostatnia = localStorage.getItem('ostatniaOpinia');
    if (ostatnia && (Date.now() - parseInt(ostatnia, 10)) < 24 * 60 * 60 * 1000) {
      document.getElementById('formMsg').textContent = 'Mo≈ºesz dodaƒá nowƒÖ opiniƒô dopiero po 24 godzinach.';
      return;
    }

    // wymagane: rating
    const rating = form.rating.value;
    if (!rating) {
      document.getElementById('formMsg').textContent = 'Wybierz ocenƒô.';
      return;
    }

    // wymagana weryfikacja e-mail poprzez modal
    const verifiedEmail = form.dataset.verifiedEmail;
    if (!verifiedEmail) {
      alert('Proszƒô najpierw zweryfikowaƒá e-mail ‚Äî kliknij "Napisz do nas" i podaj e-mail.');
      return;
    }

    const name = form.name.value.trim() || 'Anonimowy klient';
    const comment = form.comment.value.trim() || '';
    const payload = { data: { name, rating, comment, email: verifiedEmail } };

    try {
      const res = await fetch(SHEETDB_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });

      if (res.ok) {
        document.getElementById('formMsg').textContent = '‚úÖ Dziƒôkujemy za opiniƒô!';
        localStorage.setItem('ostatniaOpinia', Date.now().toString());
        // reset
        form.reset();
        delete form.dataset.verifiedEmail;
        // ukryj i od≈õwie≈º opinie
        document.getElementById('opinionForm').style.display = 'none';
        document.getElementById('showFormBtn').style.display = 'inline-block';
        loadOpinie();
      } else {
        const txt = await res.text();
        console.error('B≈ÇƒÖd zapisu:', txt);
        document.getElementById('formMsg').textContent = '‚ùå WystƒÖpi≈Ç b≈ÇƒÖd. Spr√≥buj ponownie p√≥≈∫niej.';
      }
    } catch (err) {
      console.error(err);
      document.getElementById('formMsg').textContent = 'B≈ÇƒÖd sieci. Sprawd≈∫ po≈ÇƒÖczenie z internetem.';
    }
  });

  // PoczƒÖtkowe za≈Çadowanie opinii (nie pokazujemy ich domy≈õlnie)
  // loadOpinie(); // wywo≈Çywane po klikniƒôciu "Poka≈º opinie"

  // Accessibility: zamknij modal Esc
  window.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      if (modalBackdrop.style.display === 'flex') closeModal();
    }
  });

</script>
</body>
</html>
